var hashLoc,hashSet=function(a){if(a||a.p){hashLoc=a.p;switch(a.p){default:a.d&&(hashLoc+="_"+a.d,a.d1&&(hashLoc+="_"+a.d1))}VK.callMethod("setLocation",hashLoc)}};
$(document).on("click","#project .unit",function(){location.href=URL+"&p=project&d=info&id="+$(this).attr("val")}).on("click","#proect-edit",function(){function a(){var a={op:"project_edit",id:PROJECT.id,name:$("#name").val(),about:$("#about").val()};a.name?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?(b.close(),_msg("Изменено"),document.location.reload()):b.abort()},"json")):(b.err("Не указано название"),$("#name").focus())}var b=_dialog({head:"Редактирование проекта",content:'<table id="proect-edit-tab"><tr><td class="label r">Название:<td><input id="name" type="text" value="'+
PROJECT.name+'" /><tr><td class="label r top">Описание:<td><textarea id="about">'+PROJECT.about+"</textarea></table>",butSubmit:"Сохранить",submit:a});$("#name").focus().keyEnter(a);$("#about").autosize()}).on("click",".task-edit",function(){function a(){var a={op:"task_edit",task_id:c,name:$("#name").val()};a.name?(d.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#spisok").html(a.html),d.close(),_msg("Изменено")):d.abort()},"json")):(d.err("Не указано название"),$("#name").focus())}var b=
$(this).parent().parent(),c=b.attr("val"),b=b.find(".name").html(),d=_dialog({width:430,head:"Редактирование задачи",content:'<table id="task-edit-tab"><tr><td class="label r">Проект:<td><b>'+PROJECT.name+'</b><tr><td class="label r">Задача:<td><input id="name" type="text" value="'+b+'" /></table>',butSubmit:"Сохранить",submit:a});$("#name").focus().keyEnter(a)}).on("click",".task-del",function(){var a=$(this).parent().parent(),b=a.attr("val"),a="<center><br />Подтвердите удаление задачи<br /><b>"+
a.find(".name").html()+"</b>.<br /><br /></center>",c=_dialog({width:300,head:"Удаление задачи",content:a,butSubmit:"Удалить",submit:function(){var a={op:"task_del",task_id:b};c.process();$.post(AJAX_MAIN,a,function(a){a.success?($("#spisok").html(a.html),c.close(),_msg("Удалено")):c.abort()},"json")}})}).on("click","#project-info .action-add",function(){function a(){var a={op:"action_add",task_id:d,name:$("#name").val()};a.name?(e.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#spisok").html(a.html),
e.close(),_msg("Новое действие добавлено")):e.abort()},"json")):(e.err("Не указано название"),$("#name").focus())}var b=$(this).parent().parent(),c=b.find(".name").html(),d=b.attr("val"),e=_dialog({head:"Добавление действия к задаче",content:'<table id="action-add-tab"><tr><td class="label r">Проект:<td><b>'+PROJECT.name+'</b><tr><td class="label r">Задача:<td><u>'+c+'</u><tr><td class="label r">Действие:<td><input id="name" type="text" /></table>',submit:a});$("#name").focus().keyEnter(a);$("#about").autosize()}).ready(function(){$("#project").length&&
$(".add").click(function(){function a(){var a={op:"project_add",name:$("#name").val(),about:$("#about").val()};a.name?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#spisok").html(a.html),b.close(),_msg("Новый проект добавлен")):b.abort()},"json")):(b.err("Не указано название"),$("#name").focus())}$(this);var b=_dialog({head:"Добавление нового проекта",content:'<table id="project-tab-add"><tr><td class="label r">Название:<td><input id="name" type="text" /><tr><td class="label r top">Описание:<td><textarea id="about"></textarea></table>',
submit:a});$("#name").focus().keyEnter(a);$("#about").autosize()});$("#project-info").length&&$(".add").click(function(){function a(){var a={op:"task_add",project_id:PROJECT.id,name:$("#name").val()};a.name?(b.process(),$.post(AJAX_MAIN,a,function(a){a.success?($("#spisok").html(a.html),b.close(),_msg("Новая задача добавлена")):b.abort()},"json")):(b.err("Не указано название задачи"),$("#name").focus())}$(this);var b=_dialog({top:30,width:420,head:"Добавление новой задачи",butSubmit:"Добавить",content:'<table id="task-tab-add"><tr><td class="label r">Задача:<td><input id="name" type="text" /></table>',
submit:a});$("#name").focus().keyEnter(a)})});
